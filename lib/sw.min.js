'use strict';function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var globalConfig={version:"v1.1.0",analytics:{store:"analytics",version:1}},config={cache:{enabled:!0},prefetch:{enabled:!0},defer:{images:{color:"#D8D8D8"},youtube:{enabled:!0}},analytics:{enabled:!0,maxTime:86400000}};self.addEventListener("install",onInstall),self.addEventListener("activate",onActivate),self.addEventListener("fetch",onFetch),self.addEventListener("message",onMessage);function onInstall(){self.skipWaiting()}function onActivate(a){a.waitUntil(caches.keys().then(function(a){return Promise.all(a.filter(function(a){return 0!==a.indexOf(globalConfig.version)}).map(function(a){return caches["delete"](a)}))}).then(function(){return self.clients.claim()}))}function onFetch(a){function b(a){if(!config.saveDataItems)return!1;var b=a.request,c=b.url;return!!b.headers.get("save-data")&&config.saveDataItems.some(function(a){return c.includes(a)})}function c(a){var b=a.request,c=new URL(b.url),d=c.pathname,e={isSWjs:"sw.min.js"!==d,isGETRequest:"GET"===b.method,isFromMyOrigin:c.origin===self.location.origin};config.cache.noCachePatterns&&(e.matchesPathPattern=!config.cache.noCachePatterns.some(function(a){return a.test(d)})),config.cache.noCacheItems&&(e.isNoCacheItem=!config.cache.noCacheItems.includes(d));var f=Object.keys(e).filter(function(a){return!e[a]});return!f.length}return b(a)?void a.respondWith(new Response("",{status:408,statusText:"Ignore request to save data."})):c(a)?void function(a){var b,c=a.request,d=c.headers.get("Accept"),e="static";switch(-1===d.indexOf("text/html")?-1!==d.indexOf("image")&&(e="image"):e="content",b=cacheName(e),e){case"content":a.respondWith(fetch(c).then(function(a){return deferImages(a)}).then(function(a){return deferYoutubeVideos(a)}).then(function(a){return addToCache(b,c,a)})["catch"](function(){return fetchFromCache(a)})["catch"](function(){return offlineResponse(e)}));break;default:a.respondWith(fetchFromCache(a)["catch"](function(){return fetch(c)}).then(function(a){return addToCache(b,c,a)})["catch"](function(){return offlineResponse(e)}));}}(a):config.analytics.enabled?void function(a){var b=a.request,c=new URL(b.url);["www.google-analytics.com","ssl.google-analytics.com"].includes(c.hostname)&&"/collect"===c.pathname&&a.respondWith(fetch(b).then(function(a){return store(a,b.url)})["catch"](function(a){return store(a,b.url)}))}(a):void 0}function onMessage(a){switch(a.data.command){case"setConfig":setConfig(a.data.config);break;case"prefetch":prefetch(a.data.urls);break;case"reconnected":retryAnalyticsRequests();}}function addToCache(a,b,c){if(c.ok&&config.cache.enabled){var d=c.clone();caches.open(a).then(function(a){return a.put(b,d)})}return c}function cacheName(a){return globalConfig.version+":sw-cache::"+a}function deferImages(a){var b=a.clone();return!b.ok||isImageResponse(b.headers)?a:b.text().then(function(a){return a=changeImages(a),new Response(a,{headers:b.headers})})}function deferYoutubeVideos(a){var b=a.clone();return!b.ok||isImageResponse(b.headers)?a:b.text().then(function(a){return config.defer.youtube.enabled&&(a=a.replace(/<iframe (.*) data-yt-src="https:\/\/www.youtube.com\/embed\/([a-z0-9\-]+)" (.*)><\/iframe>/gi,"<div style=\"overflow:hidden;padding-top:56.25%;position:relative;\"><iframe style=\"border:0;height:100%;left:0;position:absolute;top:0;width:100%;\" $1 src=\"https://www.youtube.com/embed/$2\" srcdoc=\"<style>*{padding:0;margin:0;overflow:hidden}html,body{height:100%}img,span{position:absolute;width:100%;top:0;bottom:0;margin:auto}span{height:1.5em;text-align:center;font:48px/1.5 sans-serif;color:white;text-shadow:0 0 0.5em black}</style><a href=https://www.youtube.com/embed/$2?autoplay=1><img src=https://img.youtube.com/vi/$2/hqdefault.jpg><span>\u25B6</span></a>\" $3></iframe></div>")),new Response(a,{headers:b.headers})})}function fetchFromCache(a){return caches.match(a.request).then(function(b){if(!b)throw Error(a.request.url+" not found in cache");return b})}function getObjectStore(a,b){return globalConfig.analytics.database.transaction(a,b).objectStore(a)}function isImageResponse(a){return-1!==a.get("content-type").indexOf("image")}function isObject(a){return a&&"object"===_typeof(a)&&!Array.isArray(a)&&null!==a}function mergeDeep(a,b){return isObject(a)&&isObject(b)&&Object.keys(b).forEach(function(c){isObject(b[c])?(!a[c]&&Object.assign(a,_defineProperty({},c,{})),mergeDeep(a[c],b[c])):Object.assign(a,_defineProperty({},c,b[c]))}),a}function offlineResponse(a){var b;return config.offline?("image"===a?config.offline.image&&(b=new Response(config.offline.image,{headers:{"Content-Type":"image/svg+xml"}})):"content"===a?config.offline.page&&(b=caches.match(config.offline.page)):void 0,b):b}function openDatabase(){var a=indexedDB.open("offline-analytics",globalConfig.analytics.version);a.onerror=function(a){console.error("IndexedDB error:",a)},a.onupgradeneeded=function(){this.result.createObjectStore(globalConfig.analytics.store,{keyPath:"url"})},a.onsuccess=function(){globalConfig.analytics.database=this.result,retryAnalyticsRequests()}}function prefetch(a){return config.prefetch.enabled?Promise.all(a.map(function(a){if(void 0!==a){var b=cacheName("content");return fetch(a).then(function(c){return addToCache(b,a,c)})}})):void 0}function retryAnalyticsRequests(){getObjectStore(globalConfig.analytics.store).getAll().onsuccess=function(a){a.target.result.forEach(function(a){var b=Date.now()-a.timestamp;if(b>config.analytics.maxTime)return void getObjectStore(globalConfig.analytics.store,"readwrite")["delete"](a.url);var c=a.url+"&qt="+b;fetch(c).then(function(b){400<=b.status||getObjectStore(globalConfig.analytics.store,"readwrite")["delete"](a.url)})})}}function sendMessage(a){self.clients.matchAll().then(function(b){b.forEach(function(b){b.postMessage({message:a})})})}function setConfig(a){config=mergeDeep(config,a),trimCaches(),config.prefetch.enabled&&config.prefetch.items&&prefetch(config.prefetch.items),openDatabase(),sendMessage("isConfigured")}function store(a,b){return getObjectStore(globalConfig.analytics.store,"readwrite").add({url:b,timestamp:Date.now()}),a}function trimCaches(){config.cache.enabled&&config.cache.maxItems&&caches.keys().then(function(a){a.map(function(a){trimCache(a)})})}function trimCache(a){caches.open(a).then(function(b){b.keys().then(function(c){c.length<=config.cache.maxItems||b["delete"](c[0]).then(function(){return trimCache(a)})})})}function changeImages(a){var b=a;for(origin=a.indexOf("<img");-1!=origin;){var c=getTextPart(b,"<img",">");if(-1<c.indexOf("data-defer")){var d=setImage(c);a=a.replace(c,d)}b=b.substr(b.indexOf(c)+1,b.length),origin=b.indexOf("<img")}return a}function setImage(a){var b=!!a.match(/width="(\d+)"/)&&a.match(/width="(\d+)"/)[1],c=!!a.match(/height="(\d+)"/)&&a.match(/height="(\d+)"/)[1];return b&&c?a.replace(/src="(.*)(\?[0-9]+)*"/gi,"src=\""+newBase64Image(b,c)+"\" data-defer-src=\"$1\""):a}function getTextPart(a,b,c){return a=a.substr(a.indexOf(b),a.length),a=a.substr(0,a.indexOf(c)+1),a}function newBase64Image(a,b){var c="<svg role=\"img\" aria-labelledby=\"offline-title\" viewBox=\"0 0 "+a+" "+b+"\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"none\" fill-rule=\"evenodd\"><path fill=\""+config.defer.images.color+"\" d=\"M0 0h"+a+"v"+b+"H0z\"/></g></svg>";return"data:image/svg+xml;base64,"+btoa(c)}